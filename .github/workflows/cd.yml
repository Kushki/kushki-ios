name: cd
on: 
  push:
    branch:
      - master  
jobs:
  master:
    runs-on: macOS-latest
    steps:
    - name: Create tag
      uses: actions/github-script@v3
      with:
       github-token: ${{ github.token }}
       script: |
        github.git.createRef({
          owner: context.repo.owner,
          repo: context.repo.repo,
          ref: "refs/tags/2.2.2a-beta",
          sha: context.sha
        })
    - name: Install Cocoapods
      run: gem install cocoapods
    - name: Deploy to Cocoapods
      run: |
        set -eo pipefail
        pod lib lint --allow-warnings
        pod trunk push --allow-warnings
      env:
        COCOAPODS_TRUNK_TOKEN: ${{ secrets.COCOAPODS_TRUNK_TOKEN }}
